# test_vulnerability_inferer.py

from engines.vulnerability.vulnerability_inferer import VulnerabilityInfererV1
from engines.vulnerability.models import VulnerabilitySignal

if __name__ == "__main__":

    # --- simulate signals from scanner ---
    signals = [
        VulnerabilitySignal(
            owasp_id="M5",
            category="INSECURE_COMMUNICATION",
            subtype="cleartext_http",
            source="smali",
            file="com/example/net/HttpClient.smali",
            line=42,
            confidence=0.6,
        ),
        VulnerabilitySignal(
            owasp_id="M5",
            category="INSECURE_COMMUNICATION",
            subtype="cleartext_http",
            source="smali",
            file="com/example/net/Api.smali",
            line=88,
            confidence=0.7,
        ),
        VulnerabilitySignal(
            owasp_id="M5",
            category="INSECURE_COMMUNICATION",
            subtype="webview_insecure_load",
            source="smali",
            file="com/example/ui/WebView.smali",
            line=19,
            confidence=0.5,
        ),
    ]

    inferer = VulnerabilityInfererV1()
    findings = inferer.infer(signals)

    print("\n[VULNERABILITY FINDINGS]")
    for f in findings:
        print("=" * 60)
        print("OWASP     :", f.owasp_id)
        print("CATEGORY  :", f.category)
        print("TITLE     :", f.title)
        print("SEVERITY  :", f.severity)
        print("CONF      :", f.confidence)
        print("SIGNALS   :", len(f.signals))
