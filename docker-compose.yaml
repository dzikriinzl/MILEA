# ═══════════════════════════════════════════════════════════════════════════
# M-ILEA — Docker Compose
# ═══════════════════════════════════════════════════════════════════════════
#
# Quick start:
#   docker compose up --build
#
# Then open http://localhost:8000 in your browser.
#
# For development (with hot-reload):
#   docker compose -f docker-compose.yaml -f docker-compose.dev.yaml up
# ═══════════════════════════════════════════════════════════════════════════

services:
  milea:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        APKTOOL_VERSION: "2.9.3"
        JADX_VERSION: "1.5.1"
    container_name: milea
    ports:
      - "${MILEA_PORT:-8000}:8000"
    environment:
      - MILEA_HOST=0.0.0.0
      - MILEA_PORT=8000
    volumes:
      # Persist analysis workspaces across container restarts
      - milea-workspaces:/app/workspaces
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
      interval: 30s
      timeout: 5s
      start_period: 15s
      retries: 3

volumes:
  milea-workspaces:
    driver: local
