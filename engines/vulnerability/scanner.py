# engines/vulnerability/scanner.py

from typing import List
from .models import VulnerabilitySignal

from .signals.smali import SmaliSignalScanner
from .signals.manifest import ManifestVulnerabilityScanner
from .network.netsec_scanner import NetworkSecurityConfigScanner
from .crypto.weak_crypto_scanner import WeakCryptographyScanner
from .credentials.hardcoded_credential_scanner import HardcodedCredentialScanner
from .privacy.privacy_scanner import PrivacyScanner
from .storage.insecure_storage_scanner import InsecureDataStorageScanner
from .input_validation.input_validation_scanner import InputValidationScanner


class VulnerabilityScanner:
    """
    Aggregate all vulnerability scanners (MobSF-style).
    """

    def __init__(self):
        self.scanners = [
            SmaliSignalScanner(),
            ManifestVulnerabilityScanner(),
            NetworkSecurityConfigScanner(),
            WeakCryptographyScanner(),
            HardcodedCredentialScanner(),
            PrivacyScanner(),
            InsecureDataStorageScanner(),
            InputValidationScanner(),
        ]

    def scan(self, workspace: str) -> List[VulnerabilitySignal]:
        signals: List[VulnerabilitySignal] = []

        for scanner in self.scanners:
            try:
                signals.extend(scanner.scan(workspace))
            except Exception as e:
                print(f"[!] {scanner.__class__.__name__} failed: {e}")

        return signals
