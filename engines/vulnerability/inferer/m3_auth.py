from .base import BaseVulnerabilityInferer
from engines.vulnerability.findings import VulnerabilityFinding


class M3AuthenticationInferer(BaseVulnerabilityInferer):

    def supported_subtypes(self):
        return ["exported_component_no_permission"]

    def infer(self, signals):
        if not signals:
            return []

        files = list({s.file for s in signals})

        return [
            VulnerabilityFinding(
                owasp_id="M3",
                title="Exported Component Without Permission",
                category="INSECURE_AUTHORIZATION",
                subtype="exported_component_no_permission",
                severity="HIGH",
                confidence=0.85,
                description="Exported Android component lacks permission protection.",
                recommendation="Restrict component exposure or require permissions.",
                remediation="Set android:exported=false or add permission.",
                evidence=[str(s.evidence) for s in signals[:5]],
                affected_files=files,
            )
        ]
