from .base import BaseVulnerabilityInferer
from engines.vulnerability.findings import VulnerabilityFinding


class M5CommunicationInferer(BaseVulnerabilityInferer):

    def supported_subtypes(self):
        return ["cleartext_http", "webview_insecure_load"]

    def infer(self, signals):
        if not signals:
            return []

        files = list({s.file for s in signals})

        return [
            VulnerabilityFinding(
                owasp_id="M5",
                title="Insecure Communication",
                category="INSECURE_COMMUNICATION",
                subtype="cleartext_or_insecure_webview",
                severity="HIGH",
                confidence=0.8,
                description="Cleartext or insecure communication detected.",
                recommendation="Enforce HTTPS and secure WebView usage.",
                remediation="Use TLS and disable cleartext traffic.",
                evidence=[s.code for s in signals[:5]],
                affected_files=files,
            )
        ]
