from dataclasses import dataclass, field
from typing import List, Optional


@dataclass
class VulnerabilityFinding:
    owasp_id: str
    title: str
    category: str
    subtype: str

    severity: str
    confidence: float

    description: str
    recommendation: str
    remediation: str

    evidence: List[str] = field(default_factory=list)
    affected_files: List[str] = field(default_factory=list)

    references: List[str] = field(default_factory=list)
    score: float = 0.0
    signal_count: int = 1

    def __post_init__(self):
        """Auto-compute score from severity + confidence if not explicitly set."""
        if self.score == 0.0 and self.severity and self.confidence:
            _w = {"CRITICAL": 4.0, "HIGH": 3.0, "MEDIUM": 2.0, "LOW": 1.0, "INFO": 0.5}
            self.score = round(_w.get(self.severity, 1.0) * self.confidence, 3)

    def as_dict(self):
        return {
            "owasp_id": self.owasp_id,
            "title": self.title,
            "category": self.category,
            "subtype": self.subtype,
            "severity": self.severity,
            "confidence": self.confidence,
            "description": self.description,
            "recommendation": self.recommendation,
            "remediation": self.remediation,
            "evidence": self.evidence,
            "affected_files": self.affected_files,
            "references": self.references,
            "score": self.score,
            "signal_count": self.signal_count,
        }
