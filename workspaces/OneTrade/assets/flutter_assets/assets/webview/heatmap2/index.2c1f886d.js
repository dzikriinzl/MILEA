function t(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function e(t,e,i){return(t=Math.round(t))<e?e:t>i?i:t}const i=new class{constructor(t){this.formatters=new Map,this.locale=t,this.parts=new Intl.NumberFormat(t).formatToParts(12345.6),this.numerals=[...new Intl.NumberFormat(t,{useGrouping:!1}).format(9876543210)].reverse(),this.index=new Map(this.numerals.map(((t,e)=>[t,e]))),this.group=new RegExp(`[${this.parts.find((t=>"group"===t.type)).value}]`,"g"),this.decimal=new RegExp(`[${this.parts.find((t=>"decimal"===t.type)).value}]`),this.numeral=new RegExp(`[${this.numerals.join("")}]`,"g")}parse(t){return(t=t.trim()).replace(this.group,"").replace(this.decimal,".").replace(this.numeral,this.getIndex)?+t:NaN}format(t,e=2){let i;return this.formatters.has(e)?i=this.formatters.get(e):(i=new Intl.NumberFormat(this.locale,{minimumFractionDigits:e,maximumFractionDigits:e}),this.formatters.set(e,i)),i.format(t)}getIndex(t){return this.index.get(t).toString()}}("en-US");function s(t,e=2,s=!1){return isNaN(t)?"0"+(s?"":"%"):i.format(100*t,e)+(s?"":"%")}function o(t,e=2){return i.format(t,e)}class a{constructor(t){this.handlers=[],this.handlers=[],this.element=t}add(t){"function"==typeof t&&this.handlers.push(t)}del(t){if(null==t)this.handlers=[];else for(let e=this.handlers.length;e>=0;e--)this.handlers[e]===t&&this.handlers.splice(e,1)}dispatch(...t){this.handlers.forEach((e=>{"function"==typeof e&&e.apply(this.element,t)}))}}class h{constructor(t,e={}){this.handlers={rotate:void 0,touchStart:void 0,multipointStart:void 0,multipointEnd:void 0,pinch:void 0,swipe:void 0,tap:void 0,doubleTap:void 0,longTap:void 0,singleTap:void 0,pressMove:void 0,twoFingerPressMove:void 0,touchMove:void 0,touchEnd:void 0,touchCancel:void 0},this.isDoubleTap=!1,this.preventTap=!1,this.start=t=>{let e=t;e.touches&&(this.now=Date.now(),this.delta=this.now-(this.last||this.now),this.v1={x:e.touches[0].pageX,y:e.touches[0].pageY},this.handlers.touchStart.dispatch(e,this.element),this.preTapPosition?(this.isDoubleTap=this.delta>0&&this.delta<=250&&Math.abs(this.preTapPosition.x-this.v1.x)<30&&Math.abs(this.preTapPosition.y-this.v1.y)<30,this.isDoubleTap&&(window.clearTimeout(this.singleTapTimeout),this.singleTapTimeout=void 0)):this.preTapPosition={x:this.v1.x,y:this.v1.y},this.preTapPosition.x=this.v1.x,this.preTapPosition.y=this.v1.y,this.last=this.now,e.touches.length>1&&(this.cancelLongTap(),this.cancelSingleTap(),this.preV||(this.preV={x:0,y:0}),this.preV.x=e.touches[1].pageX-this.v1.x,this.preV.y=e.touches[1].pageY-this.v1.y,this.pinchStartLen=this.length(this.preV),this.handlers.multipointStart.dispatch(e,this.element)),this.preventTap=!1,this.longTapTimeout=window.setTimeout((()=>{this.handlers.longTap.dispatch(e,this.element),this.preventTap=!0}),750))},this.move=t=>{let e=t;if(!e.touches)return;let i={x:e.touches[0].pageX,y:e.touches[0].pageY};if(this.isDoubleTap=!1,e.touches.length>1){let t={x:e.touches[1].pageX,y:e.touches[1].pageY},s={x:t.x-i.x,y:t.y-i.y};this.preV?(this.pinchStartLen&&this.pinchStartLen>0&&(e.zoom=this.length(s)/this.pinchStartLen,this.handlers.pinch.dispatch(e,this.element)),e.angle=this.rotateAngle(s,this.preV),this.handlers.rotate.dispatch(e,this.element)):this.preV={x:0,y:0},this.preV.x=s.x,this.preV.y=s.y,this.v2&&this.s2?(e.deltaX=(i.x-this.v2.x+t.x-this.s2.x)/2,e.deltaY=(i.y-this.v2.y+t.x-this.s2.y)/2):(e.deltaX=0,e.deltaY=0),this.handlers.twoFingerPressMove.dispatch(e,this.element),this.s2=t}else{if(this.v2){e.deltaX=i.x-this.v2.x,e.deltaY=i.y-this.v2.y,this.v1||(this.v1={x:0,y:0});let t={x:Math.abs(this.v1.x-this.v2.x),y:Math.abs(this.v1.y-this.v2.y)};(t.x>10||t.y>10)&&(this.preventTap=!0)}else e.deltaX=0,e.deltaY=0;this.handlers.pressMove.dispatch(e,this.element)}this.handlers.touchMove.dispatch(e,this.element),this.cancelLongTap(),this.v2=i,e.touches.length>1&&e.preventDefault()},this.end=t=>{let e=t;e.changedTouches&&(this.cancelLongTap(),e.touches.length<2&&(this.handlers.multipointEnd.dispatch(e,this.element),this.s2=void 0),this.v1||(this.v1={x:0,y:0}),this.v2&&(Math.abs(this.v1.x-this.v2.x)>30||Math.abs(this.v1.y-this.v2.y)>30)?(e.direction=this.swipeDirection(this.v1,this.v2),this.swipeTimeout=window.setTimeout((()=>{this.handlers.swipe.dispatch(e,this.element)}))):(this.tapTimeout=window.setTimeout((()=>{this.preventTap||this.handlers.tap.dispatch(e,this.element),this.isDoubleTap&&(this.handlers.doubleTap.dispatch(e,this.element),this.isDoubleTap=!1)}),0),this.isDoubleTap||(this.singleTapTimeout=window.setTimeout((()=>{this.handlers.singleTap.dispatch(e,this.element)}),250))),this.handlers.touchEnd.dispatch(e,this.element),this.preV||(this.preV={x:0,y:0}),this.preV.x=0,this.preV.y=0,this.zoom=1,this.pinchStartLen=void 0,this.v1=void 0,this.v2=void 0)},this.cancel=t=>{let e=t;this.cancelAll(),this.handlers.touchCancel.dispatch(e,this.element)},this.cancelAll=()=>{this.preventTap=!1,window.clearTimeout(this.singleTapTimeout),window.clearTimeout(this.tapTimeout),window.clearTimeout(this.longTapTimeout),window.clearTimeout(this.swipeTimeout),this.singleTapTimeout=void 0,this.tapTimeout=void 0,this.longTapTimeout=void 0,this.swipeTimeout=void 0},this.element="string"==typeof t?document.querySelector(t):t,this.element.addEventListener("touchstart",this.start,!1),this.element.addEventListener("touchmove",this.move,!1),this.element.addEventListener("touchend",this.end,!1),this.element.addEventListener("touchcancel",this.cancel,!1);let i=function(){};for(let t in this.handlers)this.handlers[t]=this.wrapHandler(this.element,null!=e[t]?e[t]:i);window.addEventListener("scroll",this.cancelAll)}on(t,e){let i=this.handlers[t];i&&i.add(e)}off(t,e){let i=this.handlers[t];i&&i.del(e)}destroy(){window.clearTimeout(this.singleTapTimeout),window.clearTimeout(this.tapTimeout),window.clearTimeout(this.longTapTimeout),window.clearTimeout(this.swipeTimeout),this.singleTapTimeout=void 0,this.tapTimeout=void 0,this.longTapTimeout=void 0,this.swipeTimeout=void 0,this.element.removeEventListener("touchstart",this.start),this.element.removeEventListener("touchmove",this.move),this.element.removeEventListener("touchend",this.end),this.element.removeEventListener("touchcancel",this.cancel);for(let t in this.handlers){let e=this.handlers[t];e&&(e.del(),e=void 0)}this.preV=void 0,this.pinchStartLen=void 0,this.zoom=void 0,this.isDoubleTap=void 0,this.preventTap=void 0,this.delta=void 0,this.last=void 0,this.now=void 0,this.v1=void 0,this.v2=void 0,this.preTapPosition=void 0}cancelLongTap(){window.clearTimeout(this.longTapTimeout),this.longTapTimeout=void 0}cancelSingleTap(){window.clearTimeout(this.singleTapTimeout),this.singleTapTimeout=void 0}swipeDirection(t,e){return Math.abs(t.x-e.x)>=Math.abs(t.y-e.y)?t.x-e.x>0?"Left":"Right":t.y-e.y>0?"Up":"Down"}wrapHandler(t,e){let i=new a(t);return i.add(e),i}length(t){return Math.sqrt(t.x*t.x+t.y*t.y)}dot(t,e){return t.x*e.x+t.y*e.y}angle(t,e){let i=this.length(t)*this.length(e);if(0===i)return 0;let s=this.dot(t,e)/i;return s>1&&(s=1),Math.acos(s)}cross(t,e){return t.x*e.y-e.x*t.y}rotateAngle(t,e){let i=this.angle(t,e);return this.cross(t,e)>0&&(i*=-1),180*i/Math.PI}}function n(t){return null!=t.touches}function l(t){return null!=t.pageX&&null!=t.pageY}const r={light:{fontFamily:"sans-serif",accent:"rgb(128, 128, 128)",background:"white",backgroundBorder:"white",parent0TitleFont:"black",parent1TitleFont:"white",leafTitleFont:"white",leafSubtitleFont:"rgba(255, 255, 255, 0.7)",popupBorder:"black",popupHeaderBackground:"white",popupHeaderFont:"black",popupFont:"white",popupDetailFont:"rgba(255, 255, 255, 0.7)",colorLevels:null},dark:{fontFamily:"sans-serif",accent:"rgb(58, 164, 211)",background:"rgb(23, 24, 29)",backgroundBorder:"rgb(23, 24, 29)",parent0TitleFont:"white",parent1TitleFont:"white",leafTitleFont:"white",leafSubtitleFont:"rgba(255, 255, 255, 0.7)",popupBorder:"rgb(23, 24, 29)",popupHeaderBackground:"white",popupHeaderFont:"rgb(23, 24, 29)",popupFont:"white",popupDetailFont:"rgba(255, 255, 255, 0.7)",colorLevels:null}};var c,p;(p=c||(c={})).MarketCap="Market Cap",p.MarketMover="Market Mover",p.Value="Value",p.Volume="Volume",p.Frequency="Frequency",p.ForeignBuy="Foreign Buy",p.ForeignSell="Foreign Sell",p.ForeignNetBuy="Foreign Net Buy",p.ForeignNetSell="Foreign Net Sell",p.DomesticBuy="Domestic Buy",p.DomesticSell="Domestic Sell",p.DomesticNetBuy="Domestic Net Buy",p.DomesticNetSell="Domestic Net Sell";class u{constructor(t,e={}){this.lastX=0,this.lastY=0,this.maxScale=10,this.scaleFactor=1.1,this.lastScale=1,this.dpr=window.devicePixelRatio||1,this.dragStart=null,this.downHitbox=null,this.colorMap=Object.create(null),this.hitboxMap=Object.create(null),this.anchors=Object.create(null),this.currentHitbox=null,this.activeDirty=!1,this.popupDirty=!1,this.dirty=!1,this.fontFamily="sans-serif",this.accentColor="rgb(58, 164, 211)",this.backgroundColor="black",this.backgroundBorderColor="black",this.parent0TitleFontColor="white",this.parent1TitleFontColor="white",this.leafTitleFontColor="white",this.leafSubtitleFontColor="rgba(255, 255, 255, 0.7)",this.popupBorderColor="black",this.popupHeaderBackgroundColor="white",this.popupHeaderFontColor="black",this.popupFontColor="white",this.popupDetailFontColor="rgba(255, 255, 255, 0.7)",this.isInterpolate=!1,this.customColorLevels=null,this.popupWidth=300,this.popupHeight=96,this.popupXGap=25,this.lastData={mode:"",field:"",totalValue:0,data:[]},this.onStockClick=null,this.onChangeCursorType=null,this.handleScroll=t=>{const e=t.wheelDelta?t.wheelDelta/40:t.detail?-t.detail:0;e&&this.zoom(e),t.preventDefault&&t.preventDefault()},this.canvas=t,this.theme=e.theme??r.dark,this.applyTheme(this.theme),this.onStockClick=e.onStockClick??null,this.onChangeCursorType=e.onChangeCursorType??null,this.printDetailLabel=e.printDetailLabel??!1,this.hitboxCanvas=document.createElement("canvas"),this.baseCanvas=document.createElement("canvas"),this.activeCanvas=document.createElement("canvas"),this.popupCanvas=document.createElement("canvas"),this.parentNode=t.parentNode;let i=t.width,s=t.height;this.lastX=i/2,this.lastY=s/2,this.hitboxCanvas.width=i,this.hitboxCanvas.height=s,this.baseCanvas.width=i,this.baseCanvas.height=s,this.activeCanvas.width=i,this.activeCanvas.height=s,this.popupCanvas.width=i,this.popupCanvas.height=s,this.lastWidth=i,this.lastHeight=s,this.hitboxContext=C(this.hitboxCanvas),this.baseContext=C(this.baseCanvas),this.activeContext=C(this.activeCanvas),this.popupContext=C(this.popupCanvas),this.context=C(this.canvas);let o=1,a=!1;const c=new h(t);let p=0;c.on("touchStart",(e=>{const i=t.getBoundingClientRect();if(o=1,a=!0,n(e)&&e.touches.length>0){const t=e.touches[0];this.lastX=(t.pageX-i.left)*this.dpr,this.lastY=(t.pageY-i.top)*this.dpr}else l(e)&&(this.lastX=(e.pageX-i.left)*this.dpr,this.lastY=(e.pageY-i.top)*this.dpr);this.dragStart=this.baseContext.transformedPoint(this.lastX,this.lastY),this.downHitbox=null;const s=this.hitboxContext.getImageData(this.lastX,this.lastY,1,1).data,h=w(s[0],s[1],s[2]);this.colorMap[h]&&this.hitboxMap[this.colorMap[h]]&&this.hitboxMap[this.colorMap[h]]!=this.currentHitbox?(this.currentHitbox=this.hitboxMap[this.colorMap[h]],this.activeDirty=!0,p=Date.now()):this.currentHitbox=null,this.currentHitbox&&this.currentHitbox.popup&&(this.popupDirty=!0),(this.popupDirty||this.activeDirty)&&this.redraw(),this.downHitbox=this.currentHitbox,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()})),c.on("touchMove",(e=>{if(this.downHitbox=null,Date.now()-p>1500&&(this.currentHitbox=null),this.dragStart){const i=t.getBoundingClientRect();if(n(e)&&e.touches.length>0){const t=e.touches[0];this.lastX=(t.pageX-i.left)*this.dpr,this.lastY=(t.pageY-i.top)*this.dpr}else l(e)&&(this.lastX=(e.pageX-i.left)*this.dpr,this.lastY=(e.pageY-i.top)*this.dpr);const s=this.baseContext.transformedPoint(this.lastX,this.lastY);this.move(s.x-this.dragStart.x,s.y-this.dragStart.y)}else e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()})),c.on("touchEnd",(t=>{this.dragStart=null})),c.on("pinch",(t=>{a&&(this.dragStart=null,this.currentHitbox&&(this.currentHitbox=null),this.zoom(0,t.zoom/o),o=t.zoom)})),t.addEventListener("mousedown",(e=>{this.currentHitbox&&this.currentHitbox.popup&&this.onStockClick&&this.onStockClick(this.currentHitbox.popup.stockID),this.lastX=(e.offsetX||e.pageX-t.offsetLeft)*this.dpr,this.lastY=(e.offsetY||e.pageY-t.offsetTop)*this.dpr,this.dragStart=this.baseContext.transformedPoint(this.lastX,this.lastY),this.downHitbox=this.currentHitbox}),!1);let u="",d="cursor-pointer",v="";t.addEventListener("mousemove",(e=>{if(this.lastX=(e.offsetX||e.pageX-t.offsetLeft)*this.dpr,this.lastY=(e.offsetY||e.pageY-t.offsetTop)*this.dpr,this.downHitbox=null,this.dragStart){this.currentHitbox&&(this.currentHitbox=null);const t=this.baseContext.transformedPoint(this.lastX,this.lastY);this.move(t.x-this.dragStart.x,t.y-this.dragStart.y)}else this.mouseMoveBusy||(this.mouseMoveBusy=window.setTimeout((()=>{const t=this.hitboxContext.getImageData(this.lastX,this.lastY,1,1).data,e=w(t[0],t[1],t[2]);this.colorMap[e]&&this.hitboxMap[this.colorMap[e]]&&this.hitboxMap[this.colorMap[e]]!=this.currentHitbox&&(this.currentHitbox=this.hitboxMap[this.colorMap[e]],this.activeDirty=!0),this.currentHitbox&&this.currentHitbox.popup?(this.popupDirty=!0,this.onChangeCursorType&&v!=d&&(this.onChangeCursorType(d,v),v=d)):this.onChangeCursorType&&v!=u&&(this.onChangeCursorType(u,v),v=u),(this.popupDirty||this.activeDirty)&&this.redraw(),this.mouseMoveBusy=void 0}),250)),(this.popupDirty||this.activeDirty)&&this.redraw()}),!1),t.addEventListener("mouseup",(t=>{this.dragStart=null,this.downHitbox&&(this.downHitbox,this.currentHitbox)}),!1),t.addEventListener("mouseout",(t=>{this.dragStart=null,this.downHitbox=null,this.currentHitbox&&(this.currentHitbox=null,this.activeDirty=!0,this.redraw())}),!1),t.addEventListener("DOMMouseScroll",this.handleScroll,!1),t.addEventListener("mousewheel",this.handleScroll,!1)}redraw(t){t&&(this.dirty=!0,this.lastData=t),this.dirty&&(this.activeDirty=!0),this.activeDirty&&(this.popupDirty=!0),this.popupDirty&&(this.animationFrameID||(this.animationFrameID=window.requestAnimationFrame((()=>{this.dpr=window.devicePixelRatio||1;const e=this.baseContext;let i=this.canvas.width,s=this.canvas.height;if(i<=0||s<=0)return;if(this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,i,s),this.context.restore(),this.dirty&&(e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i,s),e.restore(),this.hitboxContext.save(),this.hitboxContext.setTransform(1,0,0,1,0,0),this.hitboxContext.clearRect(0,0,i,s),this.hitboxContext.restore(),this.startDraw(t?.data??this.lastData?.data??[],0,0,this.canvas.offsetWidth,this.canvas.offsetHeight,0,[],!1),this.dirty=!1),this.activeDirty)if(this.activeContext.save(),this.activeContext.setTransform(1,0,0,1,0,0),this.activeContext.clearRect(0,0,i,s),this.activeContext.restore(),this.startDraw(t?.data??this.lastData?.data??[],0,0,this.canvas.offsetWidth,this.canvas.offsetHeight,0,[],!0),this.activeDirty=!1,this.popupContext.save(),this.popupContext.setTransform(1,0,0,1,0,0),this.popupContext.clearRect(0,0,i,s),this.popupContext.restore(),this.drawPopup(),this.popupDirty=!1,this.currentHitbox&&this.currentHitbox.popup){const t=this.currentHitbox.popup.stockID;this.canvas.setAttribute("data-stockid",t)}else this.canvas.removeAttribute("data-stockid");i/=this.dpr,s/=this.dpr;const o=this.popupXGap/this.dpr,a=this.popupWidth/this.dpr,h=this.popupHeight/this.dpr;let n=this.lastX/this.dpr+o,l=this.lastY/this.dpr;i>a?(n+a>i&&(n=this.lastX/this.dpr-o-a),n<0&&(n=i-a)):n=0,l+h>s&&(l=s-h),this.context.drawImage(this.baseCanvas,0,0,i,s),this.context.drawImage(this.activeCanvas,0,0,i,s),this.context.drawImage(this.popupCanvas,n,l,i,s),this.animationFrameID=void 0}))))}resize(t,e){this.lastWidth=t,this.lastHeight=e;const i=this.baseContext.getTransform(),s=i.a,o=i.e,a=i.f;this.zoom(-100);const h=t,n=e;this.canvas.width=h,this.canvas.height=n,this.baseCanvas.width=h,this.baseCanvas.height=n,this.hitboxCanvas.width=h,this.hitboxCanvas.height=n,this.activeCanvas.width=h,this.activeCanvas.height=n,this.popupCanvas.width=h,this.popupCanvas.height=n,this.context=C(this.canvas),this.baseContext=C(this.baseCanvas),this.hitboxContext=C(this.hitboxCanvas),this.activeContext=C(this.activeCanvas),this.popupContext=C(this.popupCanvas);const l=s/this.dpr;this.baseContext.scale(l,l),this.hitboxContext.scale(l,l),this.activeContext.scale(l,l),this.downHitbox=null,this.currentHitbox=null,this.move(o/s,a/s)}applyTheme(t){this.fontFamily=t.fontFamily,this.accentColor=t.accent,this.backgroundColor=t.background,this.backgroundBorderColor=t.backgroundBorder,this.parent0TitleFontColor=t.parent0TitleFont,this.parent1TitleFontColor=t.parent1TitleFont,this.leafTitleFontColor=t.leafTitleFont,this.leafSubtitleFontColor=t.leafSubtitleFont,this.popupBorderColor=t.popupBorder,this.popupHeaderBackgroundColor=t.popupHeaderBackground,this.popupHeaderFontColor=t.popupHeaderFont,this.popupFontColor=t.popupFont,this.popupDetailFontColor=t.popupDetailFont,this.customColorLevels=t.colorLevels,this.redraw(this.lastData)}getNewColorKey(){let t=T();for(;this.colorMap[t];)t=T();return t}getColorKeyFromID(t,e){if(this.hitboxMap[t]){const i=this.hitboxMap[t].popup;return i&&e.popup&&(i.last=e.popup.last,i.change=e.popup.change,i.changePrice=e.popup.changePrice,i.value=e.popup.value,i.label=e.popup.label,i.parentValues=e.popup.parentValues),this.hitboxMap[t].color}const i=this.getNewColorKey();return this.colorMap[i]=t,this.hitboxMap[t]={highlightID:e.highlightID,color:i,popup:e.popup??void 0},i}setupParentLabelFont(t,e){t.font=1==e?m(this.fontFamily,14/this.lastScale,400):m(this.fontFamily,16/this.lastScale,300)}getLeafTitleFontSize(t,e){let i=8;i=t>100?30:t>90?26:t>80?24:t>70?22:t>60?18:t>50?12:t>40?10:t>30?8:t>20?6:t>10?4:2;const s=e/3;return i>s&&(i=Math.floor(s)),i}setupLeafTitleFont(t,e,i){t.font=m(this.fontFamily,this.getLeafTitleFontSize(e,i),500),t.fillStyle=this.leafTitleFontColor}setupLeafSubTitleFont(t,e,i){t.font=m(this.fontFamily,Math.floor(this.getLeafTitleFontSize(e,i)/2),300),t.fillStyle=this.leafSubtitleFontColor}dimensionToLeafContentHeight(t,e){return Math.floor(1.9*this.getLeafTitleFontSize(t,e))}isDrawContent(t,e){return t>40/this.lastScale&&e>20/this.lastScale}drawRectHitbox(t,e,i,s,o,a){const h=this.getColorKeyFromID(t,a);this.hitboxContext.fillStyle=h,this.hitboxContext.fillRect(e,i,s,o)}drawRectAnchor(t,e,i,s,o){this.anchors[t]={x:e,y:i,w:s,h:o}}drawLeaf(t,e,i,o,a,h,n,l){const r=t.highlightIDParent;let c=this.currentHitbox&&this.currentHitbox.highlightID&&this.currentHitbox.highlightID.startsWith(r);if(!c&&l)return;l||(c=!1);const p=c&&this.currentHitbox&&this.currentHitbox.highlightID.startsWith(t.highlightID);l||(this.drawRectHitbox(`Hitbox_${t.stockID}`,e,i,o,a,{highlightID:t.highlightID,popup:{stockID:t.stockID,name:t.name,label:n&&n.length>1?n[0][0]+" - "+n[1][0]:n&&n.length>0?n[0][0]:"",change:t.change,changePrice:t.changePrice,value:t.value,last:t.price,parentValues:n}}),this.drawRectAnchor(`Anchor_${t.stockID}`,e,i,o,a));const u=l?this.activeContext:this.baseContext,d=c?this.accentColor:this.backgroundBorderColor,v=g(t.change,this.isInterpolate,this.customColorLevels);if(u.fillStyle=p?d:v,u.fillRect(e,i,o,a),p){const t=4/this.lastScale;u.fillStyle=v,u.fillRect(e+t,i+t,o-2*t,a-2*t)}if(u.strokeStyle=d,u.lineWidth=1/this.lastScale,u.beginPath(),u.rect(e,i,o,a),u.stroke(),u.closePath(),this.isDrawContent(o,a)){u.textAlign="center";const h=this.dimensionToLeafContentHeight(o,a);this.setupLeafTitleFont(u,o,a),u.textBaseline="top",c&&(i-=1/this.lastScale),p&&(i-=1/this.lastScale),o>60/this.lastScale&&a>50/this.lastScale?(u.textBaseline="top",u.fillText(t.stockID,e+o/2,i+(a-h)/2),this.setupLeafSubTitleFont(u,o,a),u.textBaseline="bottom",u.fillText(s(t.change/100,2),e+o/2,i+a/2+h/2)):(u.textBaseline="middle",u.fillText(t.stockID,e+o/2,i+a/2))}}drawParent(t,e,i,s,o,a,h,n){const l=t.highlightID,r=n&&this.currentHitbox&&this.currentHitbox.highlightID&&this.currentHitbox.highlightID.startsWith(l);if(n&&!r)return;if(n&&1!=a){const l=30/this.lastScale,r=2/this.lastScale,c=0;this.activeContext.strokeStyle=this.backgroundBorderColor,this.activeContext.lineWidth=1/this.lastScale,this.activeContext.beginPath(),this.activeContext.rect(e,i,s,o),this.activeContext.stroke(),this.activeContext.closePath(),o>l&&(i+=l,o-=l),s>2*r&&(e+=r,s-=2*r),o>c&&(o-=c);const p=h.filter((()=>!0));return p.push([t.label,s*o,t.value]),void this.startDraw(t.children,e,i,s,o,a+1,p,n)}const c=h.filter((()=>!0));c.push([t.label,s*o,t.value]),n||(this.drawRectHitbox("Hitbox_"+l,e,i,s,o,{highlightID:l,popup:1==a&&t.children.length>0&&d(t.children[0])?{stockID:t.children[0].stockID,name:t.children[0].name,label:(h&&h.length>0?h[0][0]+" - ":"")+t.label,change:t.children[0].change,changePrice:t.children[0].changePrice,value:t.children[0].value,last:t.children[0].price,parentValues:c}:null}),this.drawRectAnchor(`Anchor_${l}`,e,i,s,o));let p=g(t.change,this.isInterpolate,this.customColorLevels),u=30/this.lastScale,v=2/this.lastScale,f=0,x=10/this.lastScale,m=3/this.lastScale;const b=8/this.lastScale,w=15/this.lastScale;1==a?(x=15/this.lastScale,u=25/this.lastScale,v=2/this.lastScale,f=2/this.lastScale,m=3/this.lastScale,p=r?this.accentColor:p):p=this.backgroundColor;const T=1==a&&r?this.accentColor:this.backgroundBorderColor,C=n?this.activeContext:this.baseContext;if(C.fillStyle=p,C.fillStyle=1==a?r?this.accentColor:this.backgroundColor:p,r){const t=2/this.lastScale,a=2/this.lastScale,h=5/this.lastScale;C.fillRect(e-t,i-a-h,s+2*t,o+a+h)}else C.fillRect(e,i,s,o);if(1!=a||r||(C.fillStyle=p,C.fillRect(e+v,i,s-2*v,o-f)),C.strokeStyle=T,C.lineWidth=1/this.lastScale,C.beginPath(),C.rect(e,i,s,o),C.stroke(),C.closePath(),o>u){i+=u,o-=u;const h=r?3/this.lastScale:0;C.save(),C.beginPath(),C.rect(e,i-u-h,s-2,u+h),C.clip(),C.fillStyle=a>0?this.parent1TitleFontColor:this.parent0TitleFontColor,C.textAlign="start",C.textBaseline="bottom",this.setupParentLabelFont(C,a),C.fillText(t.label.toUpperCase().split("").join(String.fromCharCode(8202)),e+x,i-m-h),C.restore()}const y=e+x,S=i;s>2*v&&(e+=v,s-=2*v),o>f&&(o-=f),this.startDraw(t.children,e,i,s,o,a+1,c,n),1==a&&o>u+b+f&&(C.strokeStyle=p,C.lineWidth=3/this.lastScale,C.beginPath(),C.moveTo(y+w-1/this.lastScale,S-1/this.lastScale),C.lineTo(y+1/this.lastScale,S-1/this.lastScale),C.stroke(),C.closePath(),C.lineWidth=1/this.lastScale,C.strokeStyle=T,C.fillStyle=p,C.beginPath(),C.moveTo(y+w-.5/this.lastScale,S),C.lineTo(y+w/2,S+b),C.lineTo(y+.5/this.lastScale,S),C.fill(),C.stroke(),C.closePath())}startDraw(t,e,i,s,o,a,h,n){t.length>0&&this.draw(t,0,t.length-1,e,i,s,o,a,h,n)}draw(t,e,i,s,o,a,h,n,l,r){if(l||(l=[]),e||(e=0),i-e>1){const c=i;let p=0,u=0,d=0;for(let s=e;s<=i;s++)p+=t[s].value;if(p<=0||isNaN(p))return;for(let s=e;s<=i;s++){const o=u,a=d;if(u+=t[s].value,d=u/p,d>.5){s>e?(i=s-1,u=o,d=a):i=s;break}}if(a>=h){const p=a*d;this.draw(t,e,i,s,o,p,h,n,l,r),this.draw(t,i+1,c,s+p,o,a-p,h,n,l,r)}else{const p=h*d;this.draw(t,e,i,s,o,a,p,n,l,r),this.draw(t,i+1,c,s,o+p,a,h-p,n,l,r)}}else if(i-e>0){const i=t[e],c=t[e+1],p=i.value+c.value;if(p<=0||isNaN(p))return;const u=i.value/p;if(a>=h){const t=a*u;d(i)?this.drawLeaf(i,s,o,t,h,n,l,r):i.children&&this.drawParent(i,s,o,t,h,n,l,r),d(c)?this.drawLeaf(c,s+t,o,a-t,h,n,l,r):c.children&&this.drawParent(c,s+t,o,a-t,h,n,l,r)}else{const t=h*u;d(i)?this.drawLeaf(i,s,o,a,t,n,l,r):i.children&&this.drawParent(i,s,o,a,t,n,l,r),d(c)?this.drawLeaf(c,s,o+t,a,h-t,n,l,r):c.children&&this.drawParent(c,s,o+t,a,h-t,n,l,r)}}else{const i=t[e];d(i)?this.drawLeaf(i,s,o,a,h,n,l,r):i.children&&this.drawParent(i,s,o,a,h,n,l,r)}}drawPopup(){if(this.currentHitbox&&this.currentHitbox.popup){const t=this.popupContext;let e=window.devicePixelRatio||1,i=1;t.save(),t.setTransform(1,0,0,1,0,0),t.scale(e,e),e>1.25&&(e=1.25,i=e/window.devicePixelRatio);const a=this.currentHitbox.popup,h=this.canvas.width/e<=350;let n=h?20:25,l=h?10:20;const r=1/e,c=1/e;this.popupWidth=h?200:300,this.popupHeight=h?75:96;const p=10/e,u=10/e,d=(h?10:16)/e,v=(h?20:28)/e,f=(h?8:14)/e,x=8/e;this.printDetailLabel&&(this.popupHeight+=(a.parentValues.length+2)*(h?16:22));const b=a.changePrice||0,w=a.change||0,T=`${function(t,e=2){return t<0?o(t,e):`+${o(t,e)}`}(b,0)} (${s(w/100,2)})`;let C=a.label.toUpperCase().split("").join(String.fromCharCode(8203));const y=a.name.toUpperCase(),S=s(w/100,2);t.font=m(this.fontFamily,d,700);let D=e*t.measureText(C).width+2*l+r;for(;D>this.lastWidth*e;)C=C.substring(0,C.length-4)+"...",D=e*t.measureText(C).width+2*l+r;t.font=m(this.fontFamily,f,300);const F=e*t.measureText(y+"  "+T).width+2*l+r;this.popupWidth<D&&(this.popupWidth=D),this.popupWidth<F&&(this.popupWidth=F);const H=this.popupWidth/e,k=this.popupHeight/e;this.popupWidth/=i,this.popupHeight/=i,l/=e,n/=e,t.fillStyle=this.popupHeaderBackgroundColor,t.fillRect(r,c,H-r,k-c),t.fillStyle=this.popupHeaderFontColor,t.textAlign="start",t.textBaseline="middle",t.font=m(this.fontFamily,d,700),t.fillText(C,r+l,c+n/2+4/e);const M=g(a.change,this.isInterpolate,this.customColorLevels);t.fillStyle=M,t.fillRect(r,c+n,H-r,k-n-c),t.fillStyle=this.popupFontColor,t.textAlign="start",t.textBaseline="top",t.font=m(this.fontFamily,v,500);let P=c+n;t.fillText(a.stockID.toUpperCase(),r+l,P+p+2/e);const L=o(a.last||0,0);if(t.textAlign="end",t.fillText(L,r+H-l,P+p+2/e),P=c+k,this.printDetailLabel){t.fillStyle=this.popupDetailFontColor,t.textAlign="start",t.font=m(this.fontFamily,f,300);const i=this.lastData.mode||"",h=o(a.value,0);let d="",g="",b="",w="";a.parentValues[1]&&(g="% of "+(a.parentValues[1][0]||"Subsector"),w=s(a.value/a.parentValues[1][2],2)),a.parentValues[0]&&(d="% of "+(a.parentValues[0][0]||"Sector"),b=s(a.value/a.parentValues[0][2],2));const C=`% of ${this.lastData.field??""}`,S=s(a.value/this.lastData.totalValue,2),D=a.parentValues.length;t.fillText(y,r+l,c+n+p+v+4/e),t.textAlign="end",t.fillText(T,r+H-l,c+n+p+v+4/e),t.textAlign="start",t.textBaseline="bottom",t.fillText(i,r+l,P-u-(D+1)*(x+f)),a.parentValues[1]&&t.fillText(g,r+l,P-u-2*(x+f)),a.parentValues[0]&&t.fillText(d,r+l,P-u-x-f),t.fillText(C,r+l,P-u),t.textAlign="end",t.fillText(h,r+H-l,P-u-(D+1)*(x+f)),a.parentValues[1]&&t.fillText(w,r+H-l,P-u-2*(x+f)),a.parentValues[0]&&t.fillText(b,r+H-l,P-u-x-f),t.fillText(S,r+H-l,P-u)}else t.fillStyle=this.popupDetailFontColor,t.textAlign="start",t.textBaseline="bottom",t.font=m(this.fontFamily,f,300),t.fillText(y,r+l,P-u),t.textAlign="end",t.fillText(S,r+H-l,P-u);t.strokeStyle=this.popupBorderColor,t.lineWidth=1,t.beginPath(),t.rect(r,c,H-r,k-c),t.stroke(),t.closePath(),t.restore()}}move(t,e){const i=this.baseContext,s=i.getTransform().a,o=i.getTransform().e,a=i.getTransform().f;let h=t,n=e;const l=this.canvas.width,r=this.canvas.height,c=this.canvas.width/this.dpr,p=this.canvas.height/this.dpr,u=-o-h*s,d=-a-n*s;u<0&&(h=-o/s),u>c*s-l&&(h=-(o-l+c*s)/s),d<0&&(n=-a/s),d>p*s-r&&(n=-(a-r+p*s)/s),i.translate(h,n),this.hitboxContext.translate(h,n),this.activeContext.translate(h,n),this.dirty=!0,this.redraw()}zoom(t,e=0){const i=this.baseContext,s=i.transformedPoint(this.lastX,this.lastY);i.translate(s.x,s.y),this.hitboxContext.translate(s.x,s.y),this.activeContext.translate(s.x,s.y);let o=1-(1-e)/2;e<.01&&(o=Math.pow(this.scaleFactor,t));const a=i.getTransform().a,h=a*o;h>this.maxScale*this.dpr&&(o=this.maxScale*this.dpr/a),h<this.dpr&&(o=this.dpr/a),this.lastScale=a*o/(1+(this.dpr-1)/2),i.scale(o,o),i.translate(-s.x,-s.y),this.hitboxContext.scale(o,o),this.hitboxContext.translate(-s.x,-s.y),this.activeContext.scale(o,o),this.activeContext.translate(-s.x,-s.y),this.dirty=!0,this.move(0,0)}}function d(t){return t.isLeaf}const v=[{level:-3,color:[204,42,39]},{level:-2,color:[153,50,52]},{level:-1,color:[155,55,63]},{level:0,color:[54,62,73]},{level:1,color:[43,102,66]},{level:2,color:[32,128,61]},{level:3,color:[30,179,72]}];function g(t,e,i){null==i&&(i=v);let s=null,o=null;for(let e=0;e<i.length;e++){const a=i[e];a.level>=t&&(!o||o.level>a.level)?o=a:a.level<=t&&(!s||s.level<a.level)&&(s=a)}if(o&&s){if(e){const e=function(t,e,i=.5){const s=f(t),o=f(e);let a=o[0]-s[0];a<-.5?a+=1:a>.5&&(a-=1);let h=s[0]+a*i;h>1?h-=1:h<0&&(h+=1);const n=s[1]+(o[1]-s[1])*i,l=s[2]+(o[2]-s[2])*i;return function(t){let e=0,i=0,s=0;const o=t[0],a=t[1],h=t[2],n=Math.floor(6*o),l=6*o-n,r=h*(1-a),c=h*(1-l*a),p=h*(1-(1-l)*a);switch(n%6){case 0:e=h,i=p,s=r;break;case 1:e=c,i=h,s=r;break;case 2:e=r,i=h,s=p;break;case 3:e=r,i=c,s=h;break;case 4:e=p,i=r,s=h;break;case 5:e=h,i=r,s=c}return[255*e,255*i,255*s]}([h,n,l])}(s.color,o.color,(t-s.level)/(o.level-s.level));return w(e[0],e[1],e[2])}return Math.abs(t-s.level)<Math.abs(t-o.level)?w(s.color[0],s.color[1],s.color[2]):w(o.color[0],o.color[1],o.color[2])}return o&&!s?w(o.color[0],o.color[1],o.color[2]):s&&!o?w(s.color[0],s.color[1],s.color[2]):"rgb(68, 68, 68)"}function f(t){const e=t[0]/255,i=t[1]/255,s=t[2]/255,o=Math.max(e,i,s),a=Math.min(e,i,s);let h=o,n=o,l=o;const r=o-a;if(n=0==o?0:r/o,o==a)h=0;else{switch(o){case e:h=(i-s)/r+(i<s?6:0);break;case i:h=(s-e)/r+2;break;case s:h=(e-i)/r+4}h/=6}return[h,n,l]}const x=Object.create(null);function m(t,e,i){const s=function(t,e){e<0&&(e=0);const i=Math.pow(10,e);return 0==e?Math.round(t):Math.round(t*i)/i}(e,2);return x[t]||(x[t]=Object.create(null)),x[t][i]||(x[t][i]=Object.create(null)),x[t][i][e]||(x[t][i][e]=`${i} ${s}px ${t}`),x[t][i][e]}const b=Object.create(null);function w(t,i,s){const o=1e6*(t=e(t,0,255))+1e3*(i=e(i,0,255))+(s=e(s,0,255));if(!b[o]){const e=`rgb(${t}, ${i}, ${s})`;b[o]=e}return b[o]}function T(){return w(t(0,255),t(0,255),t(0,255))}function C(t){const e=window.devicePixelRatio||1;t.style.width=`${t.width}px`,t.style.height=`${t.height}px`,t.width*=e,t.height*=e;const i=t.getContext("2d");return function(t){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");let i=e.createSVGMatrix();t.getTransform=function(){return i};const s=[],o=t.save;t.save=function(){return s.push(i.translate(0,0)),o.call(t)};const a=t.restore;t.restore=function(){return i=s.pop(),a.call(t)};const h=t.scale;t.scale=function(e,s){return i=i.scaleNonUniform(e,s),h.call(t,e,s)};const n=t.rotate;t.rotate=function(e){return i=i.rotate(180*e/Math.PI),n.call(t,e)};const l=t.translate;t.translate=function(e,s){return i=i.translate(e,s),l.call(t,e,s)};const r=t.transform;t.transform=function(s,o,a,h,n,l){const c=e.createSVGMatrix();return c.a=s,c.b=o,c.c=a,c.d=h,c.e=n,c.f=l,i=i.multiply(c),r.call(t,s,o,a,h,n,l)};const c=t.setTransform;t.setTransform=function(e,s,o,a,h,n){return i.a=e,i.b=s,i.c=o,i.d=a,i.e=h,i.f=n,c.call(t,e,s,o,a,h,n)},t.setTranslate=function(e,i){l.call(t,e,i)},t.setScale=function(e,i){h.call(t,e,i)};const p=e.createSVGPoint();t.transformedPoint=function(t,e){return p.x=t,p.y=e,p.matrixTransform(i.inverse())}}(i),i.scale(e,e),i}let y,S=!1;window.callJsHandler=function(t,e){S&&("setDataState"==t&&y.redraw(JSON.parse(e)),"setThemeState"==t&&y.applyTheme(JSON.parse(e)))},window.addEventListener("flutterInAppWebViewPlatformReady",(t=>{!async function(){const[t,e]=await Promise.all([window.flutter_inappwebview.callHandler("getDataState"),window.flutter_inappwebview.callHandler("getThemeState")]),i=document.getElementById("heatmap"),s=document.createElement("canvas");i.appendChild(s),y=new u(s,{theme:e}),y.resize(window.innerWidth,window.innerHeight),y.redraw(t),window.onresize=()=>{y.resize(window.innerWidth,window.innerHeight)},S=!0}()}));