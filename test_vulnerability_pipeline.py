# test_vulnerability_pipeline.py

from engines.vulnerability.smali_signal_scanner import SmaliVulnerabilitySignalScanner
from engines.vulnerability.vulnerability_inferer import VulnerabilityInfererV1

if __name__ == "__main__":

    root = "workspaces/MyBCA/smali"

    scanner = SmaliVulnerabilitySignalScanner()
    inferer = VulnerabilityInfererV1()

    signals = scanner.scan(root)
    findings = inferer.infer(signals)

    print("\n[VULNERABILITY REPORT]")
    for f in findings:
        print("\n" + "=" * 70)
        print("OWASP ID   :", f.owasp_id)
        print("CATEGORY   :", f.category)
        print("TITLE      :", f.title)
        print("SEVERITY   :", f.severity)
        print("CONFIDENCE :", f.confidence)
        print("EVIDENCE   :", len(f.signals))

        for s in f.signals[:3]:
            print("  -", s.file, ":", s.subtype)
